const allQuestionArr = [
    {
        "question": " 专转 砖专?",
        "options": [
            "专砖",
            "转 ",
            "驻",
            "专 砖注"
        ],
        "correct_answer": "专砖"
    },
    {
        "question": " 住驻专 专砖 拽 转专?",
        "options": [
            "1",
            "2",
            "3",
            "5"
        ],
        "correct_answer": "2"
    },
    {
        "question": "  砖转  转?",
        "options": [
            "驻",
            "专",
            "专",
            ""
        ],
        "correct_answer": "专"
    },
    {
        "question": " 砖 拽 转 砖专?",
        "options": [
            "1948",
            "1967",
            "1956",
            "1945"
        ],
        "correct_answer": "1948"
    },
    {
        "question": " 转 转 住驻专 '专 驻专'?",
        "options": [
            "'.拽. 专",
            "'.专.专. 拽",
            "'专' 专.专. 专",
            "住 拽"
        ],
        "correct_answer": "'.拽. 专"
    },
    {
        "question": " 砖驻 专转 转专 注?",
        "options": [
            "转",
            "住驻专转",
            "住转",
            ""
        ],
        "correct_answer": "住转"
    },
    {
        "question": "  转  拽专 转专 砖砖?",
        "options": [
            "",
            "专 专抓",
            "",
            " "
        ],
        "correct_answer": " "
    },
    {
        "question": "   转专 注?",
        "options": [
            " 转",
            " ",
            " 住驻",
            "拽住 砖拽"
        ],
        "correct_answer": "拽住 砖拽"
    },
    {
        "question": " 住 转 砖 ?",
        "options": [
            "H2O",
            "CO2",
            "O2",
            "CH4"
        ],
        "correct_answer": "H2O"
    },
    {
        "question": " 砖 砖  拽 转专 注?",
        "options": [
            "砖",
            "拽",
            "住 专",
            "转拽"
        ],
        "correct_answer": "转拽"
    },
    {
        "question": " 爪专 转  ?",
        "options": [
            "专  爪'",
            "驻 驻拽住",
            "住  ",
            "专驻"
        ],
        "correct_answer": "专  爪'"
    },
    {
        "question": " 砖 转 专砖  注 专?",
        "options": [
            "1965",
            "1969",
            "1972",
            "1959"
        ],
        "correct_answer": "1969"
    },
    {
        "question": " 爪 转 驻?",
        "options": [
            "专 砖",
            "转住 住",
            "住专 专 ",
            "拽 住"
        ],
        "correct_answer": "住专 专 "
    },
    {
        "question": "  爪转 注专 驻专?",
        "options": [
            "爪专驻转",
            "",
            "住驻专",
            "专"
        ],
        "correct_answer": "爪专驻转"
    },
    {
        "question": "  住专转  驻住?",
        "options": [
            "驻驻",
            "",
            "爪",
            "住驻"
        ],
        "correct_answer": "爪"
    },
    {
        "question": " 砖转   转专 砖?",
        "options": [
            "驻专拽",
            "住",
            "专驻",
            "专拽 爪驻转"
        ],
        "correct_answer": "住"
    },
    {
        "question": " 住驻专 注爪转 祝  专?",
        "options": [
            "206",
            "201",
            "220",
            "186"
        ],
        "correct_answer": "206"
    },
    {
        "question": "   拽  转专 注?",
        "options": [
            "驻",
            "专砖 转",
            "转 ",
            "'专驻"
        ],
        "correct_answer": "转 "
    },
    {
        "question": " 注专 专 砖 ?",
        "options": [
            "",
            "专",
            "爪",
            "驻专爪"
        ],
        "correct_answer": "专"
    },
    {
        "question": "  专转 转专 注?",
        "options": [
            "驻",
            " ",
            "住专",
            "住"
        ],
        "correct_answer": " "
    },
    {
        "question": "  专砖 砖 专砖 砖 砖专?",
        "options": [
            " -专",
            " 专",
            "爪拽 专",
            " "
        ],
        "correct_answer": " -专"
    },
    {
        "question": " 专 注砖  转专 注?",
        "options": [
            "专 注砖 转",
            "专 驻'",
            " 拽",
            "专 注砖 拽"
        ],
        "correct_answer": " 拽"
    },
    {
        "question": " 砖驻转 转转 驻驻专转 转专 注?",
        "options": [
            "Python",
            "Java",
            "C#",
            "JavaScript"
        ],
        "correct_answer": "JavaScript"
    },
    {
        "question": " 转 转  ''?",
        "options": [
            " 砖拽住驻专",
            "'专' 专",
            "爪'专住 拽住",
            " 住"
        ],
        "correct_answer": " 砖拽住驻专"
    },
    {
        "question": "  专 转专 注?",
        "options": [
            "专住",
            "抓",
            "住住",
            "驻"
        ],
        "correct_answer": "抓"
    },
    {
        "question": "  爪转 注专  专拽?",
        "options": [
            "专爪转 专转",
            "拽",
            "",
            "拽住拽"
        ],
        "correct_answer": "专爪转 专转"
    },
    {
        "question": " 注 专砖 砖 驻?",
        "options": [
            "专",
            "专",
            "",
            "驻"
        ],
        "correct_answer": ""
    },
    {
        "question": " 砖转 爪转 爪专?",
        "options": [
            "住",
            "驻专拽",
            "专驻",
            "专拽 专转"
        ],
        "correct_answer": "驻专拽"
    },
    {
        "question": " 砖 转专砖 专爪 专?",
        "options": [
            "1992",
            "1995",
            "1998",
            "2000"
        ],
        "correct_answer": "1995"
    },
    {
        "question": "  砖?",
        "options": [
            "住驻专",
            "拽",
            "驻拽",
            "爪专"
        ],
        "correct_answer": "驻拽"
    },
    {
        "question": " 砖专 砖专 砖 专 专砖?",
        "options": [
            "",
            "",
            "",
            ""
        ],
        "correct_answer": ""
    },
    {
        "question": " 拽专 专 住?",
        "options": [
            " 拽专",
            " 转",
            " 拽",
            "专 住"
        ],
        "correct_answer": " 拽专"
    },
    {
        "question": "   拽 转专 注 住 ?",
        "options": [
            "",
            "驻",
            " 专",
            "专"
        ],
        "correct_answer": ""
    },
    {
        "question": "  爪 驻爪?",
        "options": [
            "",
            "爪专驻转",
            "专爪转 专转",
            "住驻专"
        ],
        "correct_answer": ""
    },
    {
        "question": " 住驻专  专 注?",
        "options": [
            "专 驻专",
            "转\"",
            " 砖",
            "砖专 注转"
        ],
        "correct_answer": "转\""
    },
    {
        "question": "  转 转 砖专 ' ''?",
        "options": [
            "住",
            "住 驻专住",
            " ",
            "' "
        ],
        "correct_answer": "住"
    }
]

const initialState = {
    gameState: 'init',
    time: 15,
    questionCnt: 1,
    corrAnswersCnt: 0,
    name: "",
    score: getBestPlayer(),
    questionData: {},
}


function shuffleQuestions() {
    for (let i = allQuestionArr.length - 1; i > 0; i--) {
        let rnd = Math.floor(Math.random() * (i + 1))
        let temp = allQuestionArr[i]
        allQuestionArr[i] = allQuestionArr[rnd]
        allQuestionArr[rnd] = temp
    }
}

function setLocalStorage(keyName, data) {
    localStorage.setItem(keyName, JSON.stringify(data));
}
function getLocalStorage(keyName) {
    return JSON.parse(localStorage.getItem(keyName))
}
function getById(elId) {
    return document.getElementById(elId)
}
function getAllByClass(className) {
    return document.querySelectorAll(`.${className}`)
}
function getBestPlayer() {
    let bScore = 0
    const gamesInfo = getLocalStorage('games-info')
    if (!gamesInfo) return bScore
    gamesInfo.map((el) => {
        bScore = Math.max(bScore, el.score)
    }
    )
    return bScore
}

function toggleTimeAlert() {
    timer.classList.toggle('low-time')
}

function getQuestion(num) {
    return allQuestionArr[num - 1];
}
function handleKeyDown(e) {
    switch (e.key) {
        // case 'a' && 'b':
        //     if (initialState.gameState !== 'init') return
        // modalContainer.remove()
        // startGame()
        // break;
        case 'a':
            checkAnswer(0)
            break;
        case 'b':
            checkAnswer(1)
            break;
        case 'c':
            checkAnswer(2)
            break;
        case 'd':
            checkAnswer(3)
            break;
        default:
            break;
    }

}
function checkAnswer(pressedBtnNum) {
    let isCorr = false
    if (initialState.questionData.options[pressedBtnNum] === initialState.questionData.correct_answer) {
        initialState.questionCnt++;
        initialState.corrAnswersCnt++;
        initialState.score += 10;
        isCorr = true;
        initialState.questionData = getQuestion(initialState.questionCnt)
        console.log(initialState.questionData);

        allSquaresEl[pressedBtnNum].classList.add('correct')
        allAnswersContainers[pressedBtnNum].classList.add('correct-answer')
    } else {
        initialState.questionCnt++
        allAnswersContainers[pressedBtnNum].classList.add('wrong')
    }
    // updateUi(pressedBtnNum, isCorr)

}
function countDown() {
    let lowerThenTen
    if (initialState.gameState === 'running') {
        const timeHandler = setInterval(() => {
            let min = Math.floor(initialState.time / 60)
            let sec = (initialState.time % 60)

            timer.innerText = `${min.toString().padStart(2, '0')}:${sec.toString().padStart(2, '0')}`
            if (initialState.time <= 10 && !lowerThenTen) {
                toggleTimeAlert()
                lowerThenTen = true
            }
            if (!min && !sec && initialState.gameState !== 'end-game') {
                clearInterval(timeHandler)
                //Need to reset game
            }
            else {
                initialState.time--;
            }
        }, 1000)
    }
}

function endGameModal(text) {
    const modalElement = `
                    <div id="dialog-container">
                        <dialog id="dialog" open>
                        <h3>砖拽 专</h3>
                        <p>爪转 注转 注 ${initialState.corrAnswersCnt} 转 ${initialState.questionCnt}</p>
                        <p>${text}</p>
                        <button id="dialog-btn" onclick="resetGame">砖拽 砖</button>
                        </dialog>
                        </div>
                        `

    document.body.insertAdjacentHTML("beforebegin", modalElement)
}

document.addEventListener('keydown', handleKeyDown)

const bestScoreEl = getById('best-score');
const bestPlayerEl = getById('best-player');
const currPlayerEl = getById('curr-player')
const currScoreEl = getById('curr-score')

const questionEl = getById('question')
const questionNumEl = getById('question-number')
const allAnswersEl = getAllByClass('answers')
const allSquaresEl = getAllByClass('square')
const allAnswersContainers = getAllByClass('answer-container')

const timer = getById('timer')

const modal = getById('dialog')
const modalContainer = getById('dialog-container')



// function startGame() {
//     shuffleQuestions()
// initialState.questionData = getQuestion(initialState.questionCnt)
//     showBestGame();
//     currPlayerEl.innerText = "砖专 砖专"
//     currScoreEl.innerText = 0
//     initialState.gameState = 'running'
//     modalContainer.remove()
//     countDown()

// }



// function startGame() {
//     //const myTimeout = setTimeout(Times_Up, 5000);
//     score = -1;
//     questionNum = 0;
// }


function endGame() {
    if (score == questionNum) {
        endGameModal(` !! 爪转 注转 注  砖转 爪  (爪专转 ${initialState.score} 拽转)`)
    } else if (score >= (questionNum / 2)) {
        endGameModal(` !! 爪转 注转 注  砖转 爪  (爪专转 ${initialState.score} 拽转)`)

    } else if (score > 0 && score < (questionNum / 2)) {
        endGameModal(` !! 爪转 注转 注  砖转 爪  (爪专转 ${initialState.score} 拽转)`)
    } else if (score == 0) {
        endGameModal(` !! 爪转 注转 注  砖转 爪  (爪专转 ${initialState.score} 拽转)`)
    }
}

let rightAnswer = true;
function handleAnswer() {
    if (rightAnswer === true) {
        initialState.questionCnt++;
        initialState.corrAnswerCnt++;
        initialState.score += 10;
    } else {
        initialState.questionCnt++;
        //initialState.score-=10;
    }
}

function updateUi(pressedNum, isCorrect) {
    if (isCorrect) {
        allSquaresEl[pressedNum].classList.remove('correct');
        allAnswerContainers[pressedBtnNum].classList.remove('correct-answer')
    } else {
        //allSquaresEl[pressedNum].classList.remove('wrong');
        allAnswerContainers[pressedBtnNum].classList.remove('wrong')
    }
    document.getElementById("curr-score").innerHTML = initialState.score;
    document.getElementById("quesstion-number").innerHTML = initialState.questionCnt;
}





function noPoint() {
    if (score == -1) {
        score++;
    }
    questionNum++;
    document.getElementById("curr-score").innerHTML = score;
    document.getElementById("quesstion-number").innerHTML = questionNum;
    if (questionNum == 11) {
        document.getElementById("quesstion-number").innerHTML = "";
        showAnnouncment();
        startGame();
    } else {
        document.getElementById("announcmentOfScore").innerHTML = "";
    }
}

function showAnnouncment() {
    if (score == 10) {
        fullVictory();
        //startGame();
    }
    else if (score >= 5 && score < 10) {
        halfVictory();
    }
    else if (score > 0 && score < 5) {
        lowVictory();
    }
    else if (score == 0) {
        lose();
    }
}

/*const myTimeout = setTimeout(Times_Up, 5000);

function Times_Up() {
  showAnnouncment();
}*/